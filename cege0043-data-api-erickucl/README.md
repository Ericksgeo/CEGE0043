# Location-Based Quiz – technical documentation for the CEGE0043 – Assignment

In this document it is possible to observe all the code developed in order to deploy and execute the requested web application.

Table of contents:

# System requirements

In order to enable the location-based features of this web application, a browser that supports geolocation access via http connection is required. It is recommended to use Chrome(Version 80.0.3987.163 (Official Build) (64-bit) or above).

Some browsers do not allows CORS with Cross-Origin information. In this case Chrome is the alternative to use this Question component.

The system connection to the Database and the SSL certificates are allocated into the private UCL network. Therefore, it is necessary to deploy this code into the UCL network environment.

# Deployment:

Once into the Ubuntu server provided by UCL private network, it is necessary to clone the master branch of the two UCL-Geospatial repositories from the course assignment:

 ucl-geospatial/cege0043-apps-erickucl

ucl-geospatial/cege0043-data-api-erickucl

After that, the pm2 service must be started, using &quot;pm2 restart all&quot;

You could check the status of the server asking for &quot;pm2 status&quot;.

# Testing:

Depending on the virtual machine port ID, the main testing URL is:

https://developer.cege.ucl.ac.uk:xxxxx/quiz2go.html

All functionalities must be available, depending on the browser and device used.

The code has different cosole.log insertions that allows to check the behaviour of the system during the loading, execution and response of all main functions. In this case, the navigator console could display the constant status of the application.

# File description:

The main HTML file is allocated in the root of the app.js folder.

**Quiz2go.html** : contains the HTML code to execute and deliver the quiz and question components to the user.

It consists in a Bootstrap CSS format, using the accordion animation and selective display, that match with the user device in which the HTML is loaded.

Each menu could allocate a sub menu, that triggers some specified function at the &quot;onclick&quot; event.

This function sequence starts a chain of process, that ends in the multiple file distribution and the respective result or event.
| QUESTION COMPONENT    |                             |                                                                                                                    |                                                   |                                             |                       |                                                                                                                                                                                                                                                               |
| --------------------- | --------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------- | ------------------------------------------- | --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Menu                  | sub menu                    | Function associated to HTML                                                                                        | popup or menu functions                           | marker function                             | js file asociated     | description                                                                                                                                                                                                                                                   |
| Current location:     |                             | currentPosition()                                                                                                  |                                                   | plotLocation(position)                      | m1CurrentLocation.js  | function to extract the navigator geolocation with Error Handling in case that location is unavailable// function to insert current location in the map as a marker, and accuracy                                                                             |
| Questions:            |                             |                                                                                                                    |                                                   |                                             |                       |                                                                                                                                                                                                                                                               |
|                       | Add questions:              | addQuestion()                                                                                                      |                                                   | processData(postString), dataUploaded(data) | m2AddQuestion.js      | create Data upload string to the server dataAPI //AJAX data upload to the server (for created questions)                                                                                                                                                      |
|                       | Load Questions:             | clean(),getQuizQuestionsLayer('questionComponent','quiz')                                                          |                                                   | cleanTracking()                             | m3Quiz2goQuestions.js | javascript for Quiz questions markers and popups // stops tracking when popup is open  // layerURL selector to quiz questions or questions added last week from all users (same geoJSON plotting with different RESTful GET calls                             |
|                       | Delete Questions:           | alert('Select a Question Point and press Delete.')                                                                 | clean(), cleanTracking()                          | deleteRecord(selectedQuestionPoint)         | m4DeleteQuestion.js   | //cleaning map for question deletion//cleaning map for popup display//delete question record on DB using AJAX from popup delete button                                                                                                                        |
| Statistics:           |                             |                                                                                                                    |                                                   |                                             |                       |                                                                                                                                                                                                                                                               |
|                       | User Participation Rate:    | partRate1()                                                                                                        | createParticipationRate1(participationRate1Json); |                                             | m8StatisticsAF2.js    | //main Function to create graph and add the D3 graph to participationRate1 CURRENT USER./function to create the D3 graph to participationRate1<br>//code from https://medium.com/@vaibhavkumar\_19430/how-to-create-a-grouped-bar-chart-in-d3-js-232c54f85894 |
|                       | All Participation Rate:     | partRate2()                                                                                                        | createParticipationRate1(participationRate2Json); |                                             | m8StatisticsAF2.js    | //main Function to create graph and add the D3 graph to participationRate1 ALL USERs./function to create the D3 graph to participationRate1<br>//code from https://medium.com/@vaibhavkumar\_19430/how-to-create-a-grouped-bar-chart-in-d3-js-232c54f85894    |
| Questions Map Layers: |                             |                                                                                                                    |                                                   |                                             |                       |                                                                                                                                                                                                                                                               |
|                       | Questions Added last week:  | getQuizQuestionsLayer('questionComponent','lastWeek')                                                              |                                                   |                                             | m3Quiz2goQuestions.js |   // layerURL selector to quiz questions or questions added last week from all users (same geoJSON plotting with different RESTful GET calls                                                                                                                  |
|                       | 5 Closest questions:        | alert('activate current location first'), currentPosition(), getQuizQuestionsLayer('questionComponent','5Closest') |                                                   |                                             | m3Quiz2goQuestions.js |   // layerURL selector to quiz questions or questions added last week from all users (same geoJSON plotting with different RESTful GET calls                                                                                                                  |
|                       | 5 most difficult questions: | hardestQuestionsList()                                                                                             | hardestQuestions(), hardestQuestionsGraph(data)   |                                             | m9QuestionsAF2.js     | //main Function to create graph and add statistics of 5 top users.//create graph for hardest questions<br>//start creating the D3 graph from D3.js //javascript to obtain json list with hardest questions                                                    |
|                       |                             |                                                                                                                    |                                                   |                                             |                       |                                                                                                                                                                                                                                                               |
| Clear Map:            |                             | clean()                                                                                                            |                                                   |                                             | m3Quiz2goQuestions.js | //cleaning map for question deletion//cleaning map for popup display                                                                                                                                                                                          |
| Help(1):              |                             | openHelp('helpquestionsc'),window.open(openHelpURL)                                                                |                                                   |                                             | zOpenHelp.js          | //javascript to load Help HTML<br>// HELP Section created using HELPNDOC sotware.<br>//Content Created by Myself, Help Functionality created through HelpNDOC.<br>//https://www.helpndoc.com/                                                                 |
|                       |                             |                                                                                                                    |                                                   |                                             |                       |                                                                                                                                                                                                                                                               |
| Leaflet legend\*      |                             | createLegend(), boardRank()                                                                                        |                                                   |                                             | m8StatisticsAF2.js    | //function to create legend box in Leaflet. To append all the statistics graphs.<br>//legend for d3 graph https://gis.stackexchange.com/questions/133630/adding-leaflet-legend                                                                                |


| QUIZ COMPONENT               |                                 |                                                                 |                                      |                                                                   |                       |                                                                                                                                                                                                                                   |
| ---------------------------- | ------------------------------- | --------------------------------------------------------------- | ------------------------------------ | ----------------------------------------------------------------- | --------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Menu                         | sub menu                        | Function associated to HTML                                     | popup or menu functions              | marker function                                                   | js file asociated     | description                                                                                                                                                                                                                       |
| Load Questions:              |                                 | currentPosition(),getQuizQuestionsLayer('quizComponent','quiz') |                                      | cleanTracking()                                                   | m3Quiz2goQuestions.js | javascript for Quiz questions markers and popups // stops tracking when popup is open  // layerURL selector to quiz questions or questions added last week from all users (same geoJSON plotting with different RESTful GET calls |
| START QUIZ!                  |                                 | startQuiz()                                                     |                                      | proximityPoint(), calculateDistance(lat1, lon1, lat2, lon2, unit) | m6StartQuiz.js        | //start quiz function, from HTML Call//javascript to start quiz proximity, functions to calculate distance and popup QUESTIONS//calculate distance between current location and questions layer points                            |
| Statistics:                  |                                 |                                                                 |                                      |                                                                   |                       |                                                                                                                                                                                                                                   |
|                              | click here to load<br>Ranking:  | userRankingAns(httpsPortNumberAPI)                              |                                      |                                                                   | m7StatisticsAF1.js    | //Javascript to obtain the User Ranking                                                                                                                                                                                           |
|                              | Score Position:                 | boardRank()                                                     | createScoreGraph(userScoresQuizJson) |                                                                   | m8StatisticsAF2.js    | //main Function to create graph and add statistics of 5 top users.                                                                                                                                                                |
| Advanced questions<br>layer: |                                 |                                                                 |                                      |                                                                   |                       |                                                                                                                                                                                                                                   |
|                              | Last 5<br>answered questions..: | getQuizQuestionsLayer('lastComponent','lastQuestions')          |                                      |                                                                   | m3Quiz2goQuestions.js |   // layerURL selector to quiz questions or questions added last week from all users (same geoJSON plotting with different RESTful GET calls                                                                                      |
|                              | Not completed<br>questions:     | startQuizNotCompleted()                                         |                                      |                                                                   | m6StartQuiz.js        | //start quiz function to complete just not previously answered questions                                                                                                                                                          |
| Clear Map:                   |                                 | clean()                                                         |                                      |                                                                   | m3Quiz2goQuestions.js | //cleaning map for question deletion//cleaning map for popup display                                                                                                                                                              |
| Help(2):                     |                                 | openHelp('helpquizc'),window.open(openHelpURL)                  |                                      |                                                                   | zOpenHelp.js          | //javascript to load Help HTML<br>// HELP Section created using HELPNDOC sotware.<br>//Content Created by Myself, Help Functionality created through HelpNDOC.<br>//https://www.helpndoc.com/                                     |
Clear

# dataAPI side

The functionality on the dataAPI side depends on the NodeJS and Express configuration and into the requests types that the web server side ask.

Thus, this application is divided in two files, crud.js and geoJSON.js.
THe first one is used in post information to the database, and to get JSON format files.

THe geoJSON file is dedicated to create geoJSON layers to be uploaded into the Leaflet map afterwards.

| crud.js file to obtain JSON information  |                    |                                                                                                                                                                                                     |
| ---------------------------------------- | ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Type                                     |                    |                                                                                                                                                                                                     |
| GET                                      | Name               | Description                                                                                                                                                                                         |
| crud.get('/correctAnsRequest/:port\_id'  | correctAnsRequest  | // CRUD GET to obtain correct answers data (ADVANCE FUNCTIONALITY 1)                                                                                                                                |
| crud.get('/userRankingRequest/:port\_id  | userRankingRequest | // CRUD GET to obtain RANKING from answers data (ADVANCE FUNCTIONALITY 1)                                                                                                                           |
| crud.get('/userScoresQuiz'               | userScoresQuiz     | // CRUD GET to obtain top 5 scorers in the quiz  (ADVANCE FUNCTIONALITY 2)                                                                                                                          |
| crud.get('/participationRate1/:port\_id' | participationRate1 | // CRUD GET to obtain graph showing daily participation rates for the past week<br>//(how many questions have been answered, and how many answers were correct) ONE USER (ADVANCE FUNCTIONALITY 2)  |
| crud.get('/participationRate2'           | participationRate2 | // CRUD GET to obtain graph showing daily participation rates for the past week<br>//(how many questions have been answered, and how many answers were correct) ALL USERS (ADVANCE FUNCTIONALITY 2) |
| crud.get('/hardestQuestions'             | hardestQuestions   | //adding get CRUD for list of the 5 most difficult questions                                                                                                                                        |
|                                          |                    |                                                                                                                                                                                                     |
| POST                                     |                    |                                                                                                                                                                                                     |
| crud.post('/insertFormData'              | insertFormData     | // CRUD POST to insert questions data                                                                                                                                                               |
| crud.post('/insertAnsData'               | insertAnsData      | // CRUD POST to insert answers data (note different DB)                                                                                                                                             |
| crud.post('/deleteFormData               | deleteFormData     | // CRUD POST to DELETE questions data                                                                                                                                                               |
Clear

| geoJSON.js file to obtain geoJSON information                 |                       |                                                                                                                                    |
| ------------------------------------------------------------- | --------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| Type                                                          |                       |                                                                                                                                    |
| GET                                                           | Name                  | Description                                                                                                                        |
| geoJSON.get('/getGeoJSON2/:tablename/:geomcolumn/:portNumber' | getGeoJSON2           | //adding get geoJSON for quiz questions passing port\_id parameter                                                                 |
| geoJSON.get('/questionsLastWeek'                              | questionsLastWeek     | //adding get geoJSON for questions added last week from all users                                                                  |
| geoJSON.get('/lastQuestions/:port\_id'                        | lastQuestions         | //adding get geoJSON showing last 5 questions that the user answered                                                               |
| geoJSON.get('/notCompletedQuestions/:port\_id                 | notCompletedQuestions | adding get geoJSON that only shows questions and calculates proximity alerts for questions that the user hasn’t answered correctly |

# Code reference

The main part of the code of this application is adapted from the lab notes of CEGE 0043 Web Mobile and GIS by Calire Ellul, including:

Bootstrap css, HTML structure, app.js, AJAX requests, SQL parses, etc.

D3 graph to group charts is from [https://medium.com/@vaibhavkumar\_19430/how-to-create-a-grouped-bar-chart-in-d3-js-232c54f85894](https://medium.com/@vaibhavkumar_19430/how-to-create-a-grouped-bar-chart-in-d3-js-232c54f85894)

d3 graph into leaflet legend comes from [https://gis.stackexchange.com/questions/133630/adding-leaflet-legend](https://gis.stackexchange.com/questions/133630/adding-leaflet-legend)

Help structure and CSS come from [https://www.helpndoc.com](https://www.helpndoc.com/) software.
